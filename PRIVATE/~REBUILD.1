@echo off
rem This tool will rebuild the full cab chain to generate a LAYOUT.INF file only.

rmdir /S /Q PRODUCTION
mkdir PRODUCTION

cd WORKSPACE

del DIRECTIVES_GENERATED.DDF
del DIRECTIVES_GENERATEDMINI.DDF
del SETUP.INF
del SETUP.RPT

copy ..\PRIVATE\DIRECTIVES_MAIN.DDF DIRECTIVES_GENERATED.DDF
copy ..\PRIVATE\DIRECTIVES_MINI.DDF DIRECTIVES_GENERATEDMINI.DDF

rem MINI.CAB

cd MINI

mkdir "..\..\PRODUCTION\MINI_CABS"
xcopy "..\..\EXTRACTED\WIN95\*.*" "..\..\PRODUCTION\MINI_CABS"
del /Q "..\..\PRODUCTION\MINI_CABS\*.cab"

echo .Set DiskDirectoryTemplate="..\PRODUCTION\MINI_CABS" >> ..\DIRECTIVES_GENERATEDMINI.DDF
echo .Set CabinetNameTemplate="MINI.CAB" >> ..\DIRECTIVES_GENERATEDMINI.DDF
cscript /Nologo ..\..\PRIVATE\SPECIAL_DIR.VBS . "MINI\" >> ..\DIRECTIVES_GENERATEDMINI.DDF

cd ..

rem PRECOPY.CAB

cd PRECOPY

echo .Set DiskDirectoryTemplate="..\PRODUCTION\WIN95" >> ..\DIRECTIVES_GENERATED.DDF
echo .Set CabinetNameTemplate="PRECOPY*.CAB" >> ..\DIRECTIVES_GENERATED.DDF
echo .New Cabinet >> ..\DIRECTIVES_GENERATED.DDF
cscript /Nologo ..\..\PRIVATE\SPECIAL_DIR.VBS . "PRECOPY\" >> ..\DIRECTIVES_GENERATED.DDF
cd ..

..\MAKECAB\makecab /F DIRECTIVES_GENERATEDMINI.DDF

echo .Set Compress=OFF >> DIRECTIVES_GENERATED.DDF
echo .Set Cabinet=OFF >> DIRECTIVES_GENERATED.DDF


cscript /Nologo ..\PRIVATE\SPECIAL_DIR.VBS "..\PRODUCTION\MINI_CABS\" "..\PRODUCTION\MINI_CABS\" >> DIRECTIVES_GENERATED.DDF

echo .Set Compress=ON >> DIRECTIVES_GENERATED.DDF
echo .Set Cabinet=ON >> DIRECTIVES_GENERATED.DDF

rem WIN95.CAB

cd WIN95
echo .Set MaxDiskSize=2048000 >> ..\DIRECTIVES_GENERATED.DDF
echo .Set DiskDirectoryTemplate="..\PRODUCTION\WIN95" >> ..\DIRECTIVES_GENERATED.DDF
echo .Set CabinetNameTemplate="WIN95_*.CAB" >> ..\DIRECTIVES_GENERATED.DDF
echo .Set InfCabinetLineFormat="PATCHME_VBS=*cab#*" >> ..\DIRECTIVES_GENERATED.DDF
echo .New Disk >> ..\DIRECTIVES_GENERATED.DDF
echo .New Cabinet >> ..\DIRECTIVES_GENERATED.DDF
cscript /Nologo ..\..\PRIVATE\SPECIAL_DIR.VBS . "WIN95\" >> ..\DIRECTIVES_GENERATED.DDF

cd ..

..\MAKECAB\makecab /F DIRECTIVES_GENERATED.DDF

rmdir /S /Q ..\PRODUCTION\MINI_CABS

del SETUP.INF
del SETUP.RPT

cd ..
